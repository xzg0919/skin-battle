<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzj.collect.core.mapper.CategoryAttrOptionMapper">
	<select id="getCategoryAttrOptionById" parameterType="Long" resultType="com.tzj.collect.core.param.ali.AliCategoryAttrOptionBean">
		SELECT
			a.id AS id,
			a.name_ AS `name`,
			a.sort_ AS sort,
			if(a.is_special = '1',CONCAT('P',20), a.price) AS price,
			a.category_attr_id AS categoryAttrId,
			a.is_special AS isSpecial,
			20 AS specialPrice
		FROM
			sb_category_attr_option a
		WHERE
			a.id = #{id}
		AND a.del_flag = 0
	</select>
   <select id="getCategoryAttrOptionList" parameterType="Long" resultType="com.tzj.collect.entity.CategoryAttrOption">
        SELECT 
	a.id AS id, 
	a.name_ AS `name`, 
	a.sort_ AS sort, 
	if(a.is_special = '1',CONCAT('P',b.special_price), b.attr_option_price) AS price, 
	a.category_attr_id AS categoryAttrId, 
	a.is_special AS isSpecial, 
	b.special_price AS specialPrice
	FROM 
		sb_category_attr_option a 
	LEFT JOIN sb_company_category_attr_option b ON a.id = b.category_attr_option_id 
	WHERE 
	a.category_attr_id = #{id} 
	AND b.attr_option_price IS NOT NULL 
	AND b.company_id = #{companyId}
	AND a.del_flag = 0
	AND b.del_flag = 0
    </select>
    <select id="getCategoryAttrOptionLists" parameterType="Long" resultType="com.tzj.collect.entity.CategoryAttrOption">
  	SELECT
		a.id AS id,
		a.name_ AS `name`,
		a.sort_ AS sort,
		a.price AS price,
		a.category_attr_id AS categoryAttrId,
		a.is_special AS isSpecial
	FROM
		sb_category_attr_option a
	WHERE
	 a.category_attr_id = #{id}
	AND a.del_flag = 0
    </select>
	<select id="getOptionByCategoryAttrIdByCompanyId" parameterType="Object" resultType="com.tzj.collect.entity.CategoryAttrOption">
		SELECT
			a.id AS id,
			a.name_ AS `name`,
			a.sort_ AS sort,
			a.price AS price,
			a.category_attr_id AS categoryAttrId,
			IF(b.is_recovery is NULL,IF(c.is_recovery IS NULL,'0',c.is_recovery),b.is_recovery) as isRecovery
		FROM
			sb_category_attr_option a
		LEFT JOIN (SELECT * FROM sb_company_category_attr_option_city a WHERE a.company_id = #{companyId} AND a.city_id = #{cityId}) b ON a.id = b.category_attr_option_id
		LEFT JOIN (SELECT * FROM sb_category_attr_option_city a WHERE  a.city_id = #{cityId}) c ON a.id = c.category_attr_option_id
		WHERE
		 a.category_attr_id = #{categoryAttrId}
		AND a.del_flag = 0
	</select>
    
    <select id="getDigitName" parameterType="int" resultType="com.tzj.collect.entity.CategoryAttrOption">
	   <!--  SELECT sca.id,sca.name_  FROM sb_category_attr sca 
	    LEFT JOIN sb_category sc 
	    ON sca.category_id = sc.id 
	    WHERE sc.id = #{param1} -->
	    SELECT sca.id,sca.name_ AS name,scc.price FROM sb_category sc 
		LEFT JOIN sb_category_attr sca 
		ON sca.`category_id` = sc.`id`
		LEFT JOIN sb_company_category scc
		ON scc.`category_id` = sc.`id`
		WHERE sc.`id`= #{param1} and scc.`company_id` = #{param2}
    </select>
        <select id="getDigitNameRePlace" parameterType="int" resultType="com.tzj.collect.entity.CategoryAttr">
	   <!--  SELECT sca.id,sca.name_  FROM sb_category_attr sca 
	    LEFT JOIN sb_category sc 
	    ON sca.category_id = sc.id 
	    WHERE sc.id = #{param1} -->
			SELECT
				sca.id,
				sca.name_ AS name
			FROM
				sb_category_attr sca
			WHERE
				sca.`category_id` = #{categoryId}
    </select>
	<select id="getAppliceOrBigOption" parameterType="String" resultType="com.tzj.collect.entity.CategoryAttrOption">
		SELECT
			c.*
		FROM
			sb_category a
		LEFT JOIN sb_category_attr b ON a.id = b.category_id
		LEFT JOIN sb_category_attr_option c ON b.id = c.category_attr_id
		WHERE c.id is not NULL
		AND a.title = #{title}
	</select>
    
</mapper>