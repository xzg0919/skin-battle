<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzj.collect.core.mapper.EnterpriseCodeMapper">

    <select id="enterpriseCodeList" parameterType="Object" resultType="Map">
        SELECT
        a.id,
        date_format(a.create_date,'%Y-%m-%d %H:%i:%S') AS createDate,
        a.customer_name AS customerName,
        a.customer_tel AS customerTel,
        a.product_name AS productName,
        b.name_ AS terminalName,
        a.price ,
        a.is_use AS isUse
        FROM
        sb_enterprise_code a
        LEFT JOIN sb_enterprise_terminal b ON a.terminal_id = b.id
        WHERE a.enterprise_id = #{enterpriseId}
        AND a.del_flag = 0
        <if test="startTime != null and startTime != '' ">
          AND a.create_date > concat(#{startTime},' 00:00:00')
        </if>
        <if test="endTime != null and endTime != '' ">
          AND concat(#{endTime},' 23:59:59') > a.create_date
        </if>
        <if test="isUse != null and isUse != ''">
            <choose>
                <when test="isUse ==0">
                    AND a.is_use in (0,1)
                </when>
                <otherwise>
                    AND a.is_use = #{isUse}
                </otherwise>
            </choose>
        </if>
        ORDER BY a.create_date desc
        LIMIT #{pageStart} ,#{pageEnd}
    </select>
    <select id="enterpriseCodeListCount" parameterType="Object" resultType="Integer">
        SELECT
        count(*)
        FROM
        sb_enterprise_code a
        LEFT JOIN sb_enterprise_terminal b ON a.terminal_id = b.id
        WHERE a.enterprise_id = #{enterpriseId}
        AND a.del_flag = 0
        <if test="startTime != null and startTime != '' ">
            AND a.create_date > concat(#{startTime},' 00:00:00')
        </if>
        <if test="endTime != null and endTime != '' ">
            AND concat(#{endTime},' 23:59:59') > a.create_date
        </if>
        <if test="isUse != null and isUse != '' ">
            <choose>
                <when test="isUse ==0">
                    AND a.is_use in (0,1)
                </when>
                <otherwise>
                    AND a.is_use = #{isUse}
                </otherwise>
            </choose>
        </if>
    </select>
    <select id="enterpriseCodeDetil" parameterType="String" resultType="Map">
        SELECT
        a.id,
        a.customer_name,
        a.customer_tel,
        a.customer_idcard,
        date_format(a.create_date,'%Y-%m-%d %H:%i:%S') AS createDate,
        a.product_name,
        b.name_,
        c.price,
        a.price as subsidiesPrice,
        a.is_use,
        a.receive_date,
        a.invoice_code,
        a.invoice_pic
    FROM
        sb_enterprise_code a
    LEFT JOIN sb_enterprise_terminal b ON a.terminal_id = b.id
    LEFT JOIN sb_enterprise_product c ON a.product_id = c.id
    WHERE a.id = #{enterpriseCodeId}
    </select>
    <select id="outEnterpriseCodeExcel" parameterType="Object" resultType="Map">
        SELECT
        a.id,
        date_format(a.create_date,'%Y-%m-%d %H:%i:%S') AS createDate,
        a.customer_name AS customerName,
        a.customer_tel AS customerTel,
        a.product_name AS productName,
        b.name_ AS terminalName,
        a.price ,
        a.is_use AS isUse
        FROM
        sb_enterprise_code a
        LEFT JOIN sb_enterprise_terminal b ON a.terminal_id = b.id
        WHERE a.enterprise_id = #{enterpriseId}
        AND a.del_flag = 0
        <if test="startTime != null and startTime != '' ">
            AND a.create_date > concat(#{startTime},' 00:00:00')
        </if>
        <if test="endTime != null and endTime != '' ">
            AND concat(#{endTime},' 23:59:59') > a.create_date
        </if>
        <if test="isUse != null and isUse != '' ">
            <choose>
                <when test="isUse ==0">
                    AND a.is_use in (0,1)
                </when>
                <otherwise>
                    AND a.is_use = #{isUse}
                </otherwise>
            </choose>
        </if>
        ORDER BY a.create_date desc
    </select>
</mapper>
