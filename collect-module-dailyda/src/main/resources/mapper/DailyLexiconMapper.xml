<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzj.collect.core.mapper.DailyLexiconMapper" >
	<select id="lexiconList" resultMap="getCheckMap">
        SELECT depth FROM daily_lexicon WHERE del_flag = 0 GROUP BY depth
    </select>
	<select id="selectDepth" resultType="Map">
        SELECT id,name_,type_id,depth FROM daily_lexicon WHERE del_flag = 0 and  depth =  #{depth}
    </select>
	<resultMap id="getCheckMap" type="map">
		<result property="depth" column="depth"/>
		<collection property="depthList" javaType="ArrayList" ofType="Map"
					select="selectDepth" column="{depth=depth}">
			<result property="id" column="id" />
			<result property="name" column="name_"/>
			<result property="typeId" column="type_id"/>
			<result property="depth" column="depth"/>
		</collection>
	</resultMap>
	<insert id="insertDailyRecords" parameterType="String">
        INSERT INTO `collect`.${tableName} (
			`uu_id`,
			`ali_user_id`,
			`lexicon_id`,
			`type_id`,
			`create_date`,
			`update_date`
		)
		VALUES
			(
				#{uuId},
				#{aliUserId},
				#{lexiconId},
				#{typeId},
				NOW(),
				NOW()
			);
	</insert>
	<update id="updateDailyRecordsList" parameterType="String">
		update  `collect`.${tableName} set user_type_id = #{typeId}, is_true = #{trueOrFalse},version_ = version_+1, update_date = NOW() where ali_user_id = #{aliUserId} and  uu_id = #{uuId} and  create_date between #{localDateBefore} and  #{localDateEnd}
	</update>
	<select id="checkDailyIsAnswer" resultType="Map">
		select uu_id, ali_user_id, type_id from `collect`.${tableName} where  del_flag = 0 and uu_id = #{uuId} and user_type_id is null
	</select>
	<select id="dailyLexiconList" resultType="Map">
		select dll.depth, ddr.uu_id as uuId, dll.name_ from  `collect`.${tableName} ddr left join daily_lexicon dll on ddr.lexicon_id = dll.id where ddr.del_flag = 0 and ddr.ali_user_id = #{aliUserId} and  ddr.create_date between #{localDateBefore} and  #{localDateEnd}
	</select>
</mapper>