<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzj.collect.mapper.FlcxRecordsMapper" >

    <select id="existTable" parameterType="String" resultType="Integer">
        select count(*)
        from information_schema.TABLES
        where LCASE(table_name)=#{tableName}
    </select>

    <update id="createNewTable" parameterType="String">
        CREATE TABLE ${tableName} (
            `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '编号',
            `lexicons` varchar(50) DEFAULT '' COMMENT '搜索关键字(模糊搜索，存的就是搜索前的值)',
            `lexicon_after` varchar(50) DEFAULT NULL COMMENT '返回结果',
            `lexicons_id` int(11) DEFAULT NULL COMMENT '结果名称id',
            `ali_user_id` varchar(20) DEFAULT NULL COMMENT '阿里用户id',
            `city` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT '城市',
            `create_date` datetime NOT NULL COMMENT '创建时间',
            `update_date` datetime NOT NULL COMMENT '更新时间',
            PRIMARY KEY (`id`),
            KEY `index_lexiconsId` (`lexicons_id`) USING BTREE
        )ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='查询记录流水'
    </update>
    <insert id="insert" parameterType="FlcxRecords">
        insert into ${tableName}
        (lexicons,lexicon_after,lexicons_id,ali_user_id,city,create_date,update_date)
        values
        (
        #{flcxRecords.lexicons},
        #{flcxRecords.lexiconAfter},
        #{flcxRecords.lexiconsId},
        #{flcxRecords.aliUserId},
        #{flcxRecords.city},
        #{flcxRecords.createDate},
        #{flcxRecords.updateDate}
        )
    </insert>
    <select id="topFive" resultType="Map" parameterType="String">
        SELECT
            fl.lexicons as lexiconAfter,
            COUNT(1) AS count_
        FROM
            ${tableName} fl
        WHERE
            fl.lexicon_after IS NOT NULL
        GROUP BY
            fl.lexicons_id
        ORDER BY
            count_ DESC
        LIMIT 0, 7;
    </select>
    <select id="selectRecordsCountList" resultType="Map" parameterType="String">
        SELECT
            fll.name_,
            COUNT(1) AS count_
        FROM
            flcx_lexicon fll
        LEFT JOIN ${tableName} frl ON fll.id = frl.lexicons_id
        WHERE
            fll.del_flag = 0
        GROUP BY
            fll.id;
    </select>


</mapper>