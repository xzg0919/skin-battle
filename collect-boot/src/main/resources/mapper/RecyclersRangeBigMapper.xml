<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzj.collect.mapper.RecyclersRangeBigMapper">

    <select id="getAreaRecyclersRange" parameterType="String" resultType="Map">
			SELECT DISTINCT
				c.id,
				c.area_name,
				IF (b.id IS NULL, 1, 2) AS isChoose,
			(SELECT COUNT(*) FROM (	SELECT * FROM sb_recyclers_range_big a WHERE a.recyclers_id =  #{recycleId} AND a.company_id =  #{companyId} AND a.del_flag = 0) b WHERE b.area_id = c.id) AS num
			FROM
				sb_company_street_big a
			INNER JOIN sb_area c ON a.area_id = c.id
			LEFT JOIN (
				SELECT
					*
				FROM
					sb_recyclers_range_big a
				WHERE
					a.recyclers_id = #{recycleId}
				AND a.company_id = #{companyId}
				AND a.del_flag = 0
			) b ON c.id = b.area_id
			WHERE
				a.company_id = #{companyId}
			AND c.parent_id =#{cityId}
		</select>

    <select id="getStreeRecyclersRange" parameterType="String" resultType="Map">
			SELECT DISTINCT
				a.id,
				a.area_name,
			IF (b.id IS NULL, 1, 2) AS isChoose,
			IF (c.id IS NULL, 1, 2) AS isEdit,
				0 AS num
			FROM
				sb_area a
			LEFT JOIN (
				SELECT
					*
				FROM
					sb_recyclers_range_big a
				WHERE
					a.recyclers_id =  #{recycleId}
				AND a.company_id = #{companyId}
				AND a.del_flag = 0
			) b ON a.id = b.street_id
			LEFT JOIN (
				SELECT
					*
				FROM
					sb_recyclers_range_big a
				WHERE
				a.company_id = #{companyId}
				AND a.recyclers_id != #{recycleId}
				AND a.del_flag = 0
			) c ON a.id = c.street_id
			WHERE
				a.parent_id = #{areaId}
	</select>

    <select id="getCommunityRecyclersRange" parameterType="String" resultType="Map">
        SELECT DISTINCT
				a.id,
				a.name_ as area_name,
				1 AS isChoose
			FROM
				sb_community a
			WHERE
				a.area_id = #{streetId}
    </select>
</mapper>