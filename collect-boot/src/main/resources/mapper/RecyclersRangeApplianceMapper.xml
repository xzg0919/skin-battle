<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzj.collect.mapper.RecyclersRangeApplianceMapper">

    <select id="getAreaRecyclersRange" parameterType="String" resultType="Map">
			SELECT DISTINCT
				c.id,
				c.area_name,
			IF (b.id IS NULL, 1, 2) AS isChoose,
			(SELECT COUNT(*) FROM (	SELECT * FROM sb_recyclers_range_appliance a WHERE a.recyclers_id =  #{recycleId} AND a.company_id =  #{companyId} AND a.del_flag = 0) b WHERE b.area_id = c.id) AS num
			FROM
				(SELECT d.* FROM
				sb_company_service a
				LEFT JOIN sb_area c ON a.area_id = c.id
				LEFT JOIN sb_area d ON c.parent_id = d.id
				WHERE a.company_id = #{companyId}
				UNION
				SELECT c.* FROM
					sb_company_street_appliance a
				INNER JOIN sb_area c ON a.area_id = c.id
				WHERE a.company_id = #{companyId}
				) c
			LEFT JOIN (
				SELECT
					*
				FROM
					sb_recyclers_range_appliance a
				WHERE
					a.recyclers_id = #{recycleId}
				AND a.company_id = #{companyId}
				AND a.del_flag = 0
			) b ON c.id = b.area_id
			WHERE
				c.parent_id =#{cityId}
		</select>

	<select id="getStreeRecyclersRange" parameterType="String" resultType="Map">
			SELECT DISTINCT
				a.id,
				a.area_name,
			IF (b.id IS NULL, 1, 2) AS isChoose,
			IF (c.id IS NULL, 1, 2) AS isEdit,
				0 AS num
			FROM
				sb_area a
			LEFT JOIN (
				SELECT
					*
				FROM
					sb_recyclers_range_appliance a
				WHERE
					a.recyclers_id =  #{recycleId}
				AND a.company_id = #{companyId}
				AND a.del_flag = 0
			) b ON a.id = b.street_id
			LEFT JOIN (
				SELECT
					*
				FROM
					sb_recyclers_range_appliance a
				WHERE
				a.company_id = #{companyId}
				AND a.recyclers_id != #{recycleId}
				AND a.del_flag = 0
			) c ON a.id = c.street_id
			WHERE
				a.parent_id = #{areaId}
	</select>

	<select id="getCommunityRecyclersRange" parameterType="String" resultType="Map">
        SELECT DISTINCT
				a.id,
				a.name_ as area_name,
				1 AS isChoose
			FROM
				sb_community a
			WHERE
				a.area_id = #{streetId}
    </select>

</mapper>